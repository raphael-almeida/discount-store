# Discount Store

This project is a solution for the proposed code backend-challenge.

## Table of Contents

1. [Installing .NET Core](#Installing-.NET-Core)
2. [Running the server application](#Running-the-server-application)
3. [Running the client application](#Running-the-client-application)
4. [Running the tests](#Running-the-tests)
5. [API Documentation](#API-documentation)
6. [Solution overview](#Solution-overview)

## Installing .NET Core

 To follow the requirement to be able to run in an Unix environment, the project was developed using .NET Core 2.2.0, SDK version 2.2.1.

To install .NET Core on the Linux distribution of your choice, please refer to the [installation guide](https://dotnet.microsoft.com/download/linux-package-manager/rhel/sdk-2.2.101).

To install .NET Core on MacOS, the installer can be downloaded [here](https://dotnet.microsoft.com/download/thank-you/dotnet-sdk-2.2.101-macos-x64-installer).

## Running the server application

At the root folder of the project, i.e. `/src/DiscountStore.Server/`, run the following command:

```
dotnet restore
```

This will restore any missing dependency for the application to startup correctly.

After the previous command finishes, run the following command:

```
dotnet run
```

If everything is fine, the console will output the URL where the application is being served. By default, it will bind to every network adapter, using the port **`5000`**.

## Running the client application

Navigate to `/src/DiscountStore.Client/`, and run the following command:

```
dotnet restore
```

then run

```
dotnet run
```

This will start a client that can communicate with the server via HTTP protocol.
Type `'help'` for instructions on how to use the client.

## Running the tests

The tests are separated in two different projects, one for Unit tests, and other for Integration tests. Both are located under the `/tests/` folder.

To execute the tests for both projects, the following command should be executed on the root folder of the solution, where the `DiscountStore.sln` file is located:

```
dotnet test DiscountStore.sln
```

## API documentation

To access the API documentation, start the server and in a web browser navigate to [http://localhost:5000/swagger](http://localhost:5000/swagger)

The API documentation is built with Swagger which provides the ability to execute the requests and see request and response examples.

## Solution overview

### Architecture

Both server and client applications are made using .NET Core.

The server exposes RESTFul APIs using .Net Core WebAPI framework which can be called by any HTTP client (browser, external applications, etc.)

The client has a command line api to perform all operations requested on the challenge description. It works as a HTTP client for the server application.

### Concurrency

In order to achieve concurrency and immutability, the solution was designed to make use of [Actors Model](https://en.wikipedia.org/wiki/Actor_model) approach.

Actors Model is the way to go nowadays for object oriented based code given that this approach brings benefits for development when requirements for concurrency are at stake.

To achieve this architecture, the project uses the [Akka.NET](https://getakka.net/) library, which is the most used library on .Net community for Actors Model. This library is a port of a framework used in Java and other JVM based languages, such as Scala.

Akka delivers lock-free concurrency handling and ensures immutability inside its own structures.

### Discount Engine

In order to make it easy for creating and changing discount rules, a discount engine was created. It imports .Net assemblies that implements a specific interface using Dependency Injection. The list of products of a specific basket is passed to the engine where all discount rules are checked and the products prices are changed if they match the condition implemented on the assembly.

The discounts requested on the challenge description were implemented and can serve as expamples of new discounts.

These examples can be found at:
 
 ```
 /src/DiscountRules/DiscountStore.DiscountRules.Cfo/
 ```
 
 and
 
 ``` 
 /src/DiscountRules/DiscountStore.DiscountRules.Cfo/DiscountStore.DiscountRules.Marketing/
 ```

 They are copied to application output folder automatically on project build and test.

### Operations

The operations requested on the challenge description (Create basket, add product, get total amount and remove basket) are accessible via HTTP RESTFul APIs. For more details about the APIs (parameters, HTTP verbs, etc) please refer to the [Swagger documentation](http://localhost:5000/swagger) with the server application running.

One important thing to mention is that the APIs require a basket id generated by the Create Basket api. For simplicity reasons, this id is a simple integer counter managed by the Actor object. In a real scenario this id should be more sophisticated, such as a Guid or a more meaningful unique identifier.
